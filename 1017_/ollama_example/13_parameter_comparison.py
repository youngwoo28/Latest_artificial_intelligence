# 13) í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ - íŒŒë¼ë¯¸í„°ì— ë”°ë¥¸ ì¶”ë¡  ê²°ê³¼ ë¹„êµ
import ollama
import time


def compare_responses(model, prompt, configs, title=""):
    """ì—¬ëŸ¬ ì„¤ì •ìœ¼ë¡œ ê°™ì€ í”„ë¡¬í”„íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ ë¹„êµ"""
    print("\n" + "=" * 80)
    print(f"{title}")
    print("=" * 80)
    print(f"í”„ë¡¬í”„íŠ¸: {prompt}")
    print("-" * 80)
    
    results = []
    for config in configs:
        print(f"\n[ì„¤ì •: {config['name']}]")
        for key, value in config['options'].items():
            print(f"  {key}: {value}")
        
        start_time = time.time()
        resp = ollama.chat(
            model=model,
            messages=[{"role": "user", "content": prompt}],
            options=config['options']
        )
        elapsed = time.time() - start_time
        
        result = resp['message']['content']
        print(f"\nì‘ë‹µ (ì†Œìš”ì‹œê°„: {elapsed:.2f}ì´ˆ):")
        print(result)
        print("-" * 80)
        
        results.append({
            'name': config['name'],
            'result': result,
            'time': elapsed
        })
    
    return results


# ============================================================================
# 1. Temperature ë¹„êµ - ì°½ì˜ì„± vs ì¼ê´€ì„±
# ============================================================================
print("\nğŸŒ¡ï¸  TEMPERATURE ë¹„êµ - ì°½ì˜ì„±ê³¼ ì¼ê´€ì„±ì˜ ê· í˜•")
print("ë‚®ì„ìˆ˜ë¡: ê²°ì •ë¡ ì , ì¼ê´€ì„± ìˆëŠ” ë‹µë³€ (ì‚¬ì‹¤ ê¸°ë°˜ ì§ˆë¬¸ì— ì í•©)")
print("ë†’ì„ìˆ˜ë¡: ì°½ì˜ì , ë‹¤ì–‘í•œ ë‹µë³€ (ì°½ì‘, ë¸Œë ˆì¸ìŠ¤í† ë°ì— ì í•©)")

temp_configs = [
    {"name": "Temperature 0.0 (ìµœì†Œ)", "options": {"temperature": 0.0, "num_predict": 100}},
    {"name": "Temperature 0.5 (ë³´í†µ)", "options": {"temperature": 0.5, "num_predict": 100}},
    {"name": "Temperature 1.0 (ë†’ìŒ)", "options": {"temperature": 1.0, "num_predict": 100}},
    {"name": "Temperature 1.5 (ë§¤ìš° ë†’ìŒ)", "options": {"temperature": 1.5, "num_predict": 100}},
]

compare_responses(
    'gemma3:1b',
    "í˜ì‹ ì ì¸ ìŠ¤ë§ˆíŠ¸í° ì•± ì•„ì´ë””ì–´ë¥¼ í•˜ë‚˜ ì œì•ˆí•´ì¤˜.",
    temp_configs,
    "Temperature ë¹„êµ - ì°½ì˜ì„± í…ŒìŠ¤íŠ¸"
)


# ============================================================================
# 2. Top-P (Nucleus Sampling) ë¹„êµ
# ============================================================================
print("\n\nğŸ¯ TOP-P ë¹„êµ - í† í° ì„ íƒ ë²”ìœ„")
print("ë‚®ì„ìˆ˜ë¡: ê°€ì¥ í™•ë¥  ë†’ì€ ì†Œìˆ˜ì˜ í† í°ë§Œ ì„ íƒ (ì§‘ì¤‘ì )")
print("ë†’ì„ìˆ˜ë¡: ë” ë§ì€ í† í° í›„ë³´ ê³ ë ¤ (ë‹¤ì–‘ì„±)")

top_p_configs = [
    {"name": "Top-P 0.1 (ë§¤ìš° ì§‘ì¤‘)", "options": {"top_p": 0.1, "temperature": 0.8}},
    {"name": "Top-P 0.5 (ë³´í†µ)", "options": {"top_p": 0.5, "temperature": 0.8}},
    {"name": "Top-P 0.9 (ê¸°ë³¸ê°’)", "options": {"top_p": 0.9, "temperature": 0.8}},
    {"name": "Top-P 1.0 (ìµœëŒ€)", "options": {"top_p": 1.0, "temperature": 0.8}},
]

compare_responses(
    'gemma3:1b',
    "AIì˜ ë¯¸ë˜ì— ëŒ€í•´ ì§§ê²Œ ì„¤ëª…í•´ì¤˜.",
    top_p_configs,
    "Top-P ë¹„êµ"
)


# ============================================================================
# 3. Top-K ë¹„êµ
# ============================================================================
print("\n\nğŸ” TOP-K ë¹„êµ - ê³ ë ¤í•  í† í° ê°œìˆ˜")
print("ë‚®ì„ìˆ˜ë¡: ìƒìœ„ Kê°œ í† í°ë§Œ ê³ ë ¤ (ë³´ìˆ˜ì )")
print("ë†’ì„ìˆ˜ë¡: ë” ë§ì€ í† í° í›„ë³´ ê³ ë ¤ (ë‹¤ì–‘ì„±)")

top_k_configs = [
    {"name": "Top-K 5 (ë§¤ìš° ì œí•œ)", "options": {"top_k": 5, "temperature": 0.8}},
    {"name": "Top-K 20 (ì œí•œì )", "options": {"top_k": 20, "temperature": 0.8}},
    {"name": "Top-K 40 (ê¸°ë³¸ê°’)", "options": {"top_k": 40, "temperature": 0.8}},
    {"name": "Top-K 100 (ë„“ìŒ)", "options": {"top_k": 100, "temperature": 0.8}},
]

compare_responses(
    'gemma3:1b',
    "í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì˜ ì¥ì  3ê°€ì§€ë¥¼ ë‚˜ì—´í•´ì¤˜.",
    top_k_configs,
    "Top-K ë¹„êµ"
)


# ============================================================================
# 4. Repeat Penalty ë¹„êµ - ë°˜ë³µ ë°©ì§€
# ============================================================================
print("\n\nğŸ” REPEAT PENALTY ë¹„êµ - ë°˜ë³µ ì–µì œ")
print("1.0: íŒ¨ë„í‹° ì—†ìŒ (ë°˜ë³µ ê°€ëŠ¥)")
print("ë†’ì„ìˆ˜ë¡: ê°™ì€ ë‹¨ì–´/êµ¬ë¬¸ ë°˜ë³µ ê°•í•˜ê²Œ ì–µì œ")

repeat_configs = [
    {"name": "Repeat Penalty 1.0 (ì—†ìŒ)", "options": {"repeat_penalty": 1.0, "temperature": 0.8}},
    {"name": "Repeat Penalty 1.1 (ê¸°ë³¸ê°’)", "options": {"repeat_penalty": 1.1, "temperature": 0.8}},
    {"name": "Repeat Penalty 1.3 (ê°•í•¨)", "options": {"repeat_penalty": 1.3, "temperature": 0.8}},
    {"name": "Repeat Penalty 1.5 (ë§¤ìš° ê°•í•¨)", "options": {"repeat_penalty": 1.5, "temperature": 0.8}},
]

compare_responses(
    'gemma3:1b',
    "Pythonì˜ ì¥ì ì„ ì„¤ëª…í•´ì¤˜. íŠ¹íˆ 'Python'ì´ë¼ëŠ” ë‹¨ì–´ë¥¼ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©í•´ì„œ.",
    repeat_configs,
    "Repeat Penalty ë¹„êµ"
)


# ============================================================================
# 5. Num Predict ë¹„êµ - ì‘ë‹µ ê¸¸ì´ ì œí•œ
# ============================================================================
print("\n\nğŸ“ NUM PREDICT ë¹„êµ - ìƒì„± í† í° ìˆ˜ ì œí•œ")
print("ì‘ë‹µì˜ ìµœëŒ€ ê¸¸ì´ë¥¼ ì œì–´í•©ë‹ˆë‹¤.")

num_predict_configs = [
    {"name": "50 í† í° (ì§§ìŒ)", "options": {"num_predict": 50, "temperature": 0.3}},
    {"name": "100 í† í° (ë³´í†µ)", "options": {"num_predict": 100, "temperature": 0.3}},
    {"name": "200 í† í° (ê¸¸ìŒ)", "options": {"num_predict": 200, "temperature": 0.3}},
    {"name": "500 í† í° (ë§¤ìš° ê¸¸ìŒ)", "options": {"num_predict": 500, "temperature": 0.3}},
]

compare_responses(
    'gemma3:1b',
    "ë¨¸ì‹ ëŸ¬ë‹ê³¼ ë”¥ëŸ¬ë‹ì˜ ì°¨ì´ë¥¼ ìì„¸íˆ ì„¤ëª…í•´ì¤˜.",
    num_predict_configs,
    "Num Predict ë¹„êµ"
)


# ============================================================================
# 6. ë³µí•© ì„¤ì • ë¹„êµ - ì‹¤ì „ ì‚¬ìš© ì˜ˆì‹œ
# ============================================================================
print("\n\nâš™ï¸  ë³µí•© ì„¤ì • ë¹„êµ - ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤")

complex_configs = [
    {
        "name": "ì •í™•í•œ ì‚¬ì‹¤ ë‹µë³€ìš©",
        "options": {
            "temperature": 0.1,
            "top_p": 0.9,
            "top_k": 20,
            "repeat_penalty": 1.1,
            "num_predict": 200
        }
    },
    {
        "name": "ì°½ì˜ì  ê¸€ì“°ê¸°ìš©",
        "options": {
            "temperature": 1.0,
            "top_p": 0.95,
            "top_k": 100,
            "repeat_penalty": 1.3,
            "num_predict": 300
        }
    },
    {
        "name": "ê°„ê²°í•œ ìš”ì•½ìš©",
        "options": {
            "temperature": 0.3,
            "top_p": 0.9,
            "top_k": 30,
            "repeat_penalty": 1.2,
            "num_predict": 100
        }
    },
    {
        "name": "ë¸Œë ˆì¸ìŠ¤í† ë°ìš©",
        "options": {
            "temperature": 1.3,
            "top_p": 0.95,
            "top_k": 80,
            "repeat_penalty": 1.4,
            "num_predict": 250
        }
    }
]

compare_responses(
    'gemma3:1b',
    "ì „ììƒê±°ë˜ í”Œë«í¼ì„ ê°œì„ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œì•ˆí•´ì¤˜.",
    complex_configs,
    "ë³µí•© ì„¤ì • ë¹„êµ - ëª©ì ë³„ ìµœì í™”"
)


# ============================================================================
# 7. ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° ë¹„êµ - ë©”ëª¨ë¦¬/ì²˜ë¦¬ ì†ë„
# ============================================================================
print("\n\nğŸ’¾ NUM_CTX ë¹„êµ - ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° í¬ê¸°")
print("ë†’ì„ìˆ˜ë¡: ë” ê¸´ ëŒ€í™”/ë¬¸ì„œ ì²˜ë¦¬ ê°€ëŠ¥ (VRAM ì‚¬ìš©ëŸ‰ ì¦ê°€)")

ctx_configs = [
    {"name": "2048 í† í° (ì‘ìŒ)", "options": {"num_ctx": 2048, "temperature": 0.3}},
    {"name": "4096 í† í° (ê¸°ë³¸)", "options": {"num_ctx": 4096, "temperature": 0.3}},
    {"name": "8192 í† í° (í¼)", "options": {"num_ctx": 8192, "temperature": 0.3}},
]

long_text = """
ì¸ê³µì§€ëŠ¥(AI)ì€ ì»´í“¨í„° ê³¼í•™ì˜ í•œ ë¶„ì•¼ë¡œ, ê¸°ê³„ê°€ ì¸ê°„ì˜ ì§€ëŠ¥ì ì¸ í–‰ë™ì„ ëª¨ë°©í•˜ë„ë¡ ë§Œë“œëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.
ìµœê·¼ ë”¥ëŸ¬ë‹ì˜ ë°œì „ìœ¼ë¡œ ì´ë¯¸ì§€ ì¸ì‹, ìì—°ì–´ ì²˜ë¦¬, ìŒì„± ì¸ì‹ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ íšê¸°ì ì¸ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìŠµë‹ˆë‹¤.
íŠ¹íˆ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì˜ ë“±ì¥ìœ¼ë¡œ ì±—ë´‡, ë²ˆì—­, ì½”ë“œ ìƒì„± ë“±ì˜ ì‘ì—…ì—ì„œ ì¸ê°„ ìˆ˜ì¤€ì˜ ì„±ëŠ¥ì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤.
"""

compare_responses(
    'gemma3:1b',
    f"ë‹¤ìŒ í…ìŠ¤íŠ¸ë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ì¤˜:\n\n{long_text}",
    ctx_configs,
    "Num CTX ë¹„êµ"
)


# ============================================================================
# íŒŒë¼ë¯¸í„° ê°€ì´ë“œ ìš”ì•½
# ============================================================================
print("\n\n" + "=" * 80)
print("ğŸ“š íŒŒë¼ë¯¸í„° ê°€ì´ë“œ ìš”ì•½")
print("=" * 80)

guide = """
1. **Temperature** (0.0 ~ 2.0)
   - 0.0~0.3: ì‚¬ì‹¤ ê¸°ë°˜ ì§ˆë¬¸, ì •í™•í•œ ë‹µë³€ í•„ìš” ì‹œ
   - 0.5~0.7: ê· í˜•ì¡íŒ ë‹µë³€
   - 0.8~1.2: ì°½ì˜ì  ê¸€ì“°ê¸°, ì•„ì´ë””ì–´ ìƒì„±
   - 1.3~2.0: ì‹¤í—˜ì , ë§¤ìš° ì°½ì˜ì  (ì¼ê´€ì„± ë‚®ìŒ)

2. **Top-P** (0.0 ~ 1.0)
   - 0.1~0.5: ì§‘ì¤‘ì , ë³´ìˆ˜ì  ì„ íƒ
   - 0.9: ê¸°ë³¸ê°’, ëŒ€ë¶€ë¶„ ìƒí™©ì— ì í•©
   - 1.0: ëª¨ë“  í† í° ê³ ë ¤

3. **Top-K** (1 ~ 100+)
   - 5~20: ë§¤ìš° ë³´ìˆ˜ì 
   - 40: ê¸°ë³¸ê°’
   - 80~100: ë‹¤ì–‘ì„± ì¦ê°€

4. **Repeat Penalty** (1.0 ~ 2.0)
   - 1.0: íŒ¨ë„í‹° ì—†ìŒ
   - 1.1: ê¸°ë³¸ê°’, ìì—°ìŠ¤ëŸ¬ìš´ ë°˜ë³µ í—ˆìš©
   - 1.3~1.5: ë°˜ë³µ ê°•í•˜ê²Œ ì–µì œ

5. **Num Predict** (1 ~ ë¬´ì œí•œ)
   - 50~100: ì§§ì€ ë‹µë³€
   - 200~300: ì¤‘ê°„ ê¸¸ì´
   - 500+: ê¸´ ì„¤ëª…, ì—ì„¸ì´

6. **Num CTX** (512 ~ 32768+)
   - 2048: ë¹ ë¥¸ ì‘ë‹µ, ì§§ì€ ëŒ€í™”
   - 4096: ê¸°ë³¸ê°’, ëŒ€ë¶€ë¶„ ìƒí™© ì í•©
   - 8192+: ê¸´ ë¬¸ì„œ, ë³µì¡í•œ ëŒ€í™”

ğŸ¯ **ì¶”ì²œ ì¡°í•©**

â€¢ ì •í™•í•œ ë‹µë³€: temperature=0.2, top_p=0.9, top_k=30
â€¢ ì°½ì˜ì  ê¸€ì“°ê¸°: temperature=1.0, top_p=0.95, top_k=80
â€¢ ì½”ë“œ ìƒì„±: temperature=0.1, top_p=0.9, repeat_penalty=1.2
â€¢ ë¸Œë ˆì¸ìŠ¤í† ë°: temperature=1.3, top_p=0.95, top_k=100
â€¢ ìš”ì•½: temperature=0.3, num_predict=150
"""

print(guide)
print("=" * 80)

